<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Keep existing head content -->
  <script async src="https://cse.google.comse.js?cx=56fe60b981d284771"></script>
</head>
<body>
  <!-- Keep existing body structure -->

  <script>
    // Replace simulated data with real CSE handling
    function parseCustomSearchResults(results) {
      const properties = [];
      
      results.forEach(item => {
        // Extract data from search result structure
        const meta = item.customMetaData || {};
        const price = meta.price || parsePriceFromSnippet(item.snippet);
        const area = meta.area || parseAreaFromTitle(item.title);
        
        properties.push({
          name: item.title,
          price: price,
          type: meta.type || 'Property',
          location: meta.location || parseLocation(item.title),
          area: area,
          link: item.link
        });
      });
      
      return properties;
    }

    // Helper functions to extract data from text
    function parsePriceFromSnippet(snippet) {
      const priceMatch = snippet.match(/\$\d{1,3}(?:,\d{3})*/);
      return priceMatch ? priceMatch[0].replace(/\D/g, '') : 'N/A';
    }

    function parseLocation(title) {
      return title.split(' in ').pop().split(' - ')[0];
    }

    // Modified search results handler
    (function() {
      const cx = '56fe60b981d284771'; // Your CSE ID
      const gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = `https://cse.google.com/cse.js?cx=${cx}`;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);

      window.__gcse = {
        parsetags: 'explicit',
        callback: () => {
          google.search.cse.element.render({
            div: "property-list",
            tag: 'search'
          }).setResultHandler(results => {
            const propertyData = parseCustomSearchResults(results.results);
            displaySearchResults(propertyData);
          });
        }
      };
    })();

    // Modified comparison function
    function compareProperties() {
      const selected = document.querySelectorAll('.compare-checkbox:checked');
      
      if (selected.length !== 2) {
        alert('Please select exactly 2 properties to compare');
        return;
      }

      const comparisonData = Array.from(selected).map(checkbox => ({
        name: checkbox.dataset.name,
        price: checkbox.dataset.price,
        type: checkbox.dataset.type,
        area: checkbox.dataset.area,
        location: checkbox.dataset.location
      }));

      // Build comparison table dynamically
      const tableBody = document.getElementById('comparison-table-body');
      tableBody.innerHTML = comparisonData.map(item => `
        <tr>
          <td>${item.name}</td>
          <td>${item.location}</td>
          <td>$${item.price}</td>
          <td>${item.type}</td>
          <td>${item.area} sqft</td>
        </tr>
      `).join('');

      document.getElementById('comparison-table-container').style.display = 'block';
    }

    // Modified display function with proper data attributes
    function displaySearchResults(results) {
      const container = document.getElementById('property-list');
      container.innerHTML = results.map(result => `
        <div class="property-item">
          <label>
            <input type="checkbox" class="compare-checkbox"
              data-name="${result.name}"
              data-price="${result.price}"
              data-type="${result.type}"
              data-area="${result.area}"
              data-location="${result.location}">
            ${result.name} - ${result.type} (${result.area} sqft) - $${result.price}
          </label>
        </div>
      `).join('');
    }
  </script>
</body>
</html>
